YUI.add("TreeViewAriaPlugin",function(a){if(!a.YUI2)return;var b=a.YUI2;b.util.Event.onDOMReady(function(){function v(a,b){a&&a.setAttribute(m,b)}function w(a,b,c){a&&a.setAttribute(l+b,c)}function x(a){(a.hasChildren(!0)||a.isDynamic())&&w(a.getLabelEl(),u,!1)}function y(a){(a.hasChildren(!0)||a.isDynamic())&&w(a.getLabelEl(),u,!0)}if(!b.widget.TreeView||b.env.modules.treeviewariaplugin)return;var a=b.util.Dom,c=b.util.Event,d=b.lang,e=b.env.ua,f=b.widget.TreeView.prototype,g=f.init,h=f.render,i=b.widget.Node.prototype,j=i.loadComplete,k=!0,l="aria-",m="role",n="presentation",o="tree",p="treeitem",q="group",r="setsize",s="posinset",t="level",u="expanded";d.augmentObject(f,{_setUseARIA:function(a){},init:function(){g.apply(this,arguments);if(!k)return;this.subscribe("expand",y),this.subscribe("collapse",x)},render:function(){h.call(this);if(!k)return;var a=!0,b,c;for(var d in this._nodes)c=this._nodes[d],typeof c!="function"&&this._nodes.hasOwnProperty(d)&&(c.addFunctionalAria(),c.addPresentationRoles(),!this.currentFocus&&a?(b=c.getLabelEl(),b.setAttribute("tabindex",0),c._focusHighlightedItems.push(b),this.currentFocus=c,a=!1):c===this.currentFocus&&(b=c.getLabelEl(),b.setAttribute("tabindex",0)));v(this.root.getEl(),o),v(this.getEl(),q),v(this.root.getChildrenEl(),n)},_onKeyDownEvent:function(a){var c=b.util.Event.getTarget(a),d=this.getNodeByElement(c),e=d,f=b.util.KeyListener.KEY,g;switch(a.keyCode){case f.UP:do if(e.previousSibling){g=e.previousSibling;while(g&&g.expanded&&g.children.length)g=g.children[g.children.length-1];e=g}else e=e.parent;while(e&&!e._canHaveFocus());e&&e.focus(),b.util.Event.preventDefault(a);break;case f.DOWN:do if(e.children.length&&e.expanded)e=e.children[0];else if(e.nextSibling)e=e.nextSibling;else{g=e.parent;while(g){if(g.nextSibling){e=g.nextSibling;break}g=g.parent}}while(e&&!e._canHaveFocus);e&&e.focus(),b.util.Event.preventDefault(a);break;case f.LEFT:d.collapse(),b.util.Event.preventDefault(a);break;case f.RIGHT:d.expand(),b.util.Event.preventDefault(a);break;case f.ENTER:d.href?d.target?window.open(d.href,d.target):window.location=d.href:d.toggle(),this.fireEvent("enterKeyPressed",d),b.util.Event.preventDefault(a);break;case f.HOME:e=this.getRoot(),e.children.length&&(e=e.children[0]),e._canHaveFocus()&&e.focus(),b.util.Event.preventDefault(a);break;case f.END:e=e.parent.children,e=e[e.length-1],e._canHaveFocus()&&e.focus(),b.util.Event.preventDefault(a);break;case 107:a.shiftKey?d.parent.expandAll():d.expand();break;case 109:a.shiftKey?d.parent.collapseAll():d.collapse()}}},"render","init","_setUseARIA","_onKeyDownEvent"),d.augmentObject(i,{addPresentationRoles:function(){var b=this.getEl(),c=a.getElementsByClassName("ygtvrow","tr",b),d=a.getElementsByClassName("ygtvspacer","div",b),e=a.getElementsByClassName("ygtvtable","table",b),f=this.getToggleEl().firstChild;for(var g in e)typeof e[g]!="function"&&e.hasOwnProperty(g)&&(v(e[g],n),v(e[g].firstChild,n));for(var h in c)typeof c[h]!="function"&&c.hasOwnProperty(h)&&v(c[h],n);for(var i in d)typeof d[i]!="function"&&d.hasOwnProperty(i)&&v(d[i],n);v(this.getContentEl(),n),v(this.getToggleEl(),n),v(this.getEl(),n),v(f,n),f.setAttribute("tabindex",-1)},addFunctionalAria:function(){var a=this.depth+1,b=this.getToggleEl(),c=this.getLabelEl();if(!b||!c)return;var d=this.parent.children.length,e=this.getPositionInSet();v(c,p),c.setAttribute("tabindex",-1),w(c,t,a),w(c,r,d),w(c,s,e),(this.expanded||this.hasChildren(!0))&&w(c,u,this.expanded);var f=this.getChildrenEl();v(f,q)},loadComplete:function(){j.call(this);if(!k)return;var a;for(var b in this.children)a=this.children[b],typeof a!="function"&&this.children.hasOwnProperty(b)&&(a.addFunctionalAria(),a.addPresentationRoles())},getPositionInSet:function(){var a=this.parent.children.slice(0),b=0;while(b<a.length&&a[b]!=this)b++;return b+1},_removeFocus:function(){this._focusedItem&&(c.removeListener(this._focusedItem,"blur"),this._focusedItem=null);var d;while(d=this._focusHighlightedItems.shift())d.setAttribute("tabindex",-1),a.removeClass(d,b.widget.TreeView.FOCUS_CLASS_NAME)}},!0),b.register("treeviewariaplugin",b.widget.TreeView,{version:"1",build:"1"})})},"2.7.0",{requires:["yui2-yahoo","yui2-dom","yui2-event","yui2-treeview"]});